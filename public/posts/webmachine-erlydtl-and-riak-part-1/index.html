
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Webmachine, ErlyDTL and Riak - Part 1 - OJ's rants</title>
  <meta name="author" content="OJ Reeves">

  <link rel="openid.server" href="http://www.myopenid.com/server" />
  <link rel="openid.delegate" href="http://thecolonial.myopenid.com/" />
  <link rel="openid2.local_id" href="http://thecolonial.myopenid.com" />
  <link rel="openid2.provider" href="http://www.myopenid.com/server" />
  <meta http-equiv="X-XRDS-Location" content="http://www.myopenid.com/xrds?username=thecolonial.myopenid.com" />


  
  <meta name="description" content="It has been a long time coming, but the first post is finally here! This is the first in a series of post, as promised a while ago, covering off web &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="http://feeds.feedburner.com/OjsRants" rel="alternate" title="OJ's rants RSS 2.0" type="application/rss+xml">
  <link rel="canonical" href="http://buffered.io/posts/webmachine-erlydtl-and-riak-part-1">
  <link href="/favicon.ico" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/javascripts/modernizr-2.0.js" type="text/javascript"></script>
  <script src="/javascripts/ender.js" type="text/javascript"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>

  <script type="text/javascript">
    Modernizr.load([
      { load: '//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js' },
      { load: '/javascripts/jquery.lightbox.js', complete: function() {
        $("a[rel^='lightbox']").lightbox();
      } }
    ]);
  </script>

  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-8648787-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">OJ's rants</a></h1>
  
    <h2>It's not about you, it's about the software</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/OjsRants" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:buffered.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/posts/archives">Archives</a></li>
  <li><a href="/+">About</a></li>
  <li><a href="http://www.google.com/recaptcha/mailhide/d?k=01KtoERsnUusX9vVliTm27uQ==&c=Be1wE57A4P96e6U9_HLCvw==">Contact</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Webmachine, ErlyDTL and Riak - Part 1</h1>
    
    
      <p class="meta">
        








  



  

<time datetime="2010-09-01T23:29:00+10:00" pubdate data-updated="true">01 Sep 2010</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><img src="/uploads/2010/09/riak-logo.png" alt="Riak Logo" style="float:left;padding-right:5px;padding-bottom:5px;"/>It has been a long time coming, but the first post is finally here! This is the first in a series of post, as <a href="/posts/the-future-is-erlang/" title="The Future is Erlang">promised a while ago</a>, covering off web development using <a href="http://erlang.org/" title="Erlang">Erlang</a>. This post is the ubiquitous &#8220;get up and running&#8221; post, which aims to get your environment set up so that you can dive in to development. The next post will detail how to handle a basic end-to-end web request.</p>

<p><img src="/uploads/2010/09/Erlang_logo.png" width="150" style="float:right;margin-left:5px;margin-bottom:5px;"/>First up, a few things we need to be aware of before we begin:</p>

<ol>
<li>The information in this post has only been verified on Linux (<a href="http://linuxmint.com/" title="Linux Mint">Mint</a> to be exact). It <em>should</em> work just fine on Mac OSX. I&#8217;m almost certain that it <em>won&#8217;t</em> work on a Windows machine. So if you&#8217;re a Windows developer, you&#8217;ll have to wait for another post down the track which covers off how to get your environment ready to rock.</li>
<li>We&#8217;ll be downloading, building and installing <a href="http://erlang.org/" title="Erlang">Erlang</a>, <a href="http://github.com/evanmiller/erlydtl" title="ErlyDTL">ErlyDTL</a>, <a href="http://www.basho.com/developers.html#Riak" title="Riak">Riak</a> and <a href="http://www.basho.com/developers.html#Webmachine" title="Webmachine">Webmachine</a>.</li>
<li><a href="http://www.basho.com/developers.html#Rebar" title="Rebar">Rebar</a> is the tool we&#8217;ll be using to handle builds, but I won&#8217;t be covering it in any depth.</li>
<li>You will need the latest versions of both <a href="http://hg-scm.com/" title="Mercurial">Mercurial</a> and <a href="http://git-scm.com/" title="Git">Git</a> so make sure they&#8217;re downloaded and installed before you follow this article.</li>
<li>We&#8217;ll be doing <em>some</em> interaction with Riak via <a href="http://curl.haxx.se/" title="cURL and libcurl">curl</a>, so make sure you have it downloaded and installed as well.</li>
<li>This is intended to be a step-by-step guide targeted at those who are very new to web development in Erlang. This may not be the most ideal set up, nor the best way of doing certain things. I am hoping that those people who are more experienced than I will be able to provide feedback and guidance in areas where I am lacking.</li>
<li>Over the course of this series I&#8217;ll be attempting to build an Erlang version of the <a href="http://bitbucket.org/OJ/codesmackdown" title="Code Smackdown">Code Smackdown</a> site that I&#8217;ve been working on here and there with a <a href="http://secretgeek.net/" title="secretGeek">mate of mine</a>. You&#8217;ll see that the sample application we&#8217;re working on is called &#8220;csd&#8221; for obvious reasons.</li>
</ol>


<p>OK, let&#8217;s get into it. First up, Erlang.</p>

<!--more-->


<h3>Installing Erlang R15B01</h3>

<p>Download and installation is fairly simple. Right now we&#8217;re not worried about enabling all of the features of Erlang, such as interfacing with Java and providing support for GTK. So the boilerplate functionality is enough. Here are the steps to follow:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog $ wget http://erlang.org/download/otp_src_R15B01.tar.gz
</span><span class='line'>
</span><span class='line'>  ... snip ...
</span><span class='line'>
</span><span class='line'>oj@air ~/blog $ tar -xzf otp_src_R15B01.tar.gz 
</span><span class='line'>oj@air ~/blog $ cd otp_src_R15B01/
</span><span class='line'>oj@air ~/blog/otp_src_R15B01 $ ./configure 
</span><span class='line'>
</span><span class='line'>  ... snip ...
</span><span class='line'>
</span><span class='line'>oj@air ~/blog/otp_src_R15B01 $ make
</span><span class='line'>
</span><span class='line'>  ... snip ...
</span><span class='line'>
</span><span class='line'>oj@air ~/blog/otp_src_R15B01 $ sudo make install
</span><span class='line'>
</span><span class='line'>  ... snip ...</span></code></pre></td></tr></table></div></figure>


<p>Done! Let&#8217;s confirm that it has been set up correctly:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog $ erl
</span><span class='line'>Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-poll:false]
</span><span class='line'>
</span><span class='line'>Eshell V5.9.1  (abort with ^G)
</span><span class='line'>1> q().
</span><span class='line'>ok</span></code></pre></td></tr></table></div></figure>


<p>Excellent. Next let&#8217;s get Riak going.</p>

<h3>Installing Riak 1.1.4</h3>

<p>Considering the power of the software you are about to set up, it is absolutely insane how easy it is to get it running. If any of you have tried to get <a href="http://couchdb.apache.org/" title="CouchDB">CouchDB</a> running you&#8217;ll no doubt have experienced a few quirks and a bit of pain getting it rolling. Not so with Riak. As mentioned at the start of the article, make sure you have a recent version of <a href="http://hg-scm.com/" title="Mercurial">Mercurial</a> and <a href="http://git-scm.com/" title="Git">Git</a> installed.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog $ git clone git://github.com/basho/riak
</span><span class='line'>Cloning into riak...
</span><span class='line'>remote: Counting objects: 12989, done.
</span><span class='line'>remote: Compressing objects: 100% (4210/4210), done.
</span><span class='line'>remote: Total 12989 (delta 8494), reused 12871 (delta 8386)
</span><span class='line'>Receiving objects: 100% (12989/12989), 9.82 MiB | 168 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (8494/8494), done.
</span><span class='line'>
</span><span class='line'>oj@air ~/blog $ cd riak
</span><span class='line'>oj@air ~/blog/riak $ make
</span><span class='line'>
</span><span class='line'>./rebar get-deps
</span><span class='line'>==> rel (get-deps)
</span><span class='line'>==> riak (get-deps)
</span><span class='line'>Pulling cluster_info from {git,"git://github.com/basho/cluster_info",
</span><span class='line'>                               {branch,"master"}}
</span><span class='line'>Cloning into cluster_info...
</span><span class='line'>Pulling riak_kv from {git,"git://github.com/basho/riak_kv",{branch,"master"}}
</span><span class='line'>Cloning into riak_kv...
</span><span class='line'>Pulling riak_search from {git,"git://github.com/basho/riak_search",
</span><span class='line'>                              {branch,"master"}}
</span><span class='line'>Cloning into riak_search...
</span><span class='line'>Pulling riak_control from {git,"git://github.com/basho/riak_control",
</span><span class='line'>                               {branch,"master"}}
</span><span class='line'>Cloning into riak_control...
</span><span class='line'>==> cluster_info (get-deps)
</span><span class='line'>==> riak_kv (get-deps)
</span><span class='line'>Pulling riak_core from {git,"git://github.com/basho/riak_core","master"}
</span><span class='line'>Cloning into riak_core...
</span><span class='line'>Pulling luke from {git,"git://github.com/basho/luke","master"}
</span><span class='line'>Cloning into luke...
</span><span class='line'>Pulling erlang_js from {git,"git://github.com/basho/erlang_js","master"}
</span><span class='line'>Cloning into erlang_js...
</span><span class='line'>Pulling bitcask from {git,"git://github.com/basho/bitcask","master"}
</span><span class='line'>Cloning into bitcask...
</span><span class='line'>Pulling merge_index from {git,"git://github.com/basho/merge_index","master"}
</span><span class='line'>Cloning into merge_index...
</span><span class='line'>Pulling ebloom from {git,"git://github.com/basho/ebloom","master"}
</span><span class='line'>Cloning into ebloom...
</span><span class='line'>Pulling eper from {git,"git://github.com/basho/eper.git","master"}
</span><span class='line'>Cloning into eper...
</span><span class='line'>Pulling eleveldb from {git,"git://github.com/basho/eleveldb.git","master"}
</span><span class='line'>Cloning into eleveldb...
</span><span class='line'>Pulling sext from {git,"git://github.com/esl/sext","master"}
</span><span class='line'>Cloning into sext...
</span><span class='line'>Pulling riak_pipe from {git,"git://github.com/basho/riak_pipe.git","master"}
</span><span class='line'>Cloning into riak_pipe...
</span><span class='line'>Pulling riak_api from {git,"git://github.com/basho/riak_api.git","master"}
</span><span class='line'>Cloning into riak_api...
</span><span class='line'>==> riak_core (get-deps)
</span><span class='line'>Pulling lager from {git,"git://github.com/basho/lager",{branch,"master"}}
</span><span class='line'>Cloning into lager...
</span><span class='line'>Pulling poolboy from {git,"git://github.com/basho/poolboy",{branch,"master"}}
</span><span class='line'>Cloning into poolboy...
</span><span class='line'>Pulling protobuffs from {git,"git://github.com/basho/erlang_protobuffs",
</span><span class='line'>                             {branch,"master"}}
</span><span class='line'>Cloning into protobuffs...
</span><span class='line'>Pulling basho_stats from {git,"git://github.com/basho/basho_stats","HEAD"}
</span><span class='line'>Cloning into basho_stats...
</span><span class='line'>Pulling riak_sysmon from {git,"git://github.com/basho/riak_sysmon",
</span><span class='line'>                              {branch,"master"}}
</span><span class='line'>Cloning into riak_sysmon...
</span><span class='line'>Pulling webmachine from {git,"git://github.com/basho/webmachine",
</span><span class='line'>                             {branch,"master"}}
</span><span class='line'>Cloning into webmachine...
</span><span class='line'>Pulling folsom from {git,"git://github.com/basho/folsom.git",
</span><span class='line'>                         {branch,"master"}}
</span><span class='line'>Cloning into folsom...
</span><span class='line'>==> lager (get-deps)
</span><span class='line'>==> poolboy (get-deps)
</span><span class='line'>==> protobuffs (get-deps)
</span><span class='line'>Pulling meck from {git,"git://github.com/eproxus/meck",{branch,"master"}}
</span><span class='line'>Cloning into meck...
</span><span class='line'>==> meck (get-deps)
</span><span class='line'>==> basho_stats (get-deps)
</span><span class='line'>==> riak_sysmon (get-deps)
</span><span class='line'>==> webmachine (get-deps)
</span><span class='line'>Pulling mochiweb from {git,"git://github.com/basho/mochiweb",
</span><span class='line'>                           {tag,"1.5.1-riak-1.0.x-fixes"}}
</span><span class='line'>Cloning into mochiweb...
</span><span class='line'>==> mochiweb (get-deps)
</span><span class='line'>==> folsom (get-deps)
</span><span class='line'>Pulling bear from {git,"git://github.com/boundary/bear.git","master"}
</span><span class='line'>Cloning into bear...
</span><span class='line'>==> bear (get-deps)
</span><span class='line'>==> luke (get-deps)
</span><span class='line'>==> erlang_js (get-deps)
</span><span class='line'>==> bitcask (get-deps)
</span><span class='line'>==> merge_index (get-deps)
</span><span class='line'>==> ebloom (get-deps)
</span><span class='line'>==> eper (get-deps)
</span><span class='line'>Pulling getopt from {git,"git://github.com/jcomellas/getopt.git",
</span><span class='line'>                         {tag,"v0.4.3"}}
</span><span class='line'>Cloning into getopt...
</span><span class='line'>==> getopt (get-deps)
</span><span class='line'>==> eleveldb (get-deps)
</span><span class='line'>Cloning into leveldb...
</span><span class='line'>Note: checking out 'fbe66f44e9abeb4f2de3c89d91573b7879226e6c'.
</span><span class='line'>
</span><span class='line'>You are in 'detached HEAD' state. You can look around, make experimental
</span><span class='line'>changes and commit them, and you can discard any commits you make in this
</span><span class='line'>state without impacting any branches by performing another checkout.
</span><span class='line'>
</span><span class='line'>If you want to create a new branch to retain commits you create, you may
</span><span class='line'>do so (now or later) by using -b with the checkout command again. Example:
</span><span class='line'>
</span><span class='line'>  git checkout -b new_branch_name
</span><span class='line'>
</span><span class='line'>HEAD is now at fbe66f4... Merge pull request #17 from basho/mv-compress-msg
</span><span class='line'>==> sext (get-deps)
</span><span class='line'>Pulling edown from {git,"git://github.com/esl/edown.git","HEAD"}
</span><span class='line'>Cloning into edown...
</span><span class='line'>==> edown (get-deps)
</span><span class='line'>==> riak_pipe (get-deps)
</span><span class='line'>==> riak_api (get-deps)
</span><span class='line'>Pulling riak_pb from {git,"git://github.com/basho/riak_pb.git","master"}
</span><span class='line'>Cloning into riak_pb...
</span><span class='line'>==> riak_pb (get-deps)
</span><span class='line'>==> lucene_parser (get-deps)
</span><span class='line'>==> riak_search (get-deps)
</span><span class='line'>==> riak_control (get-deps)
</span><span class='line'>./rebar compile
</span><span class='line'>==> cluster_info (compile)
</span><span class='line'>Compiled src/cluster_info_ex.erl
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>==> riak_core (compile)
</span><span class='line'>Compiling src/riak_core.proto
</span><span class='line'>
</span><span class='line'>=INFO REPORT==== 11-Jul-2012::22:06:02 ===
</span><span class='line'>Writing header file to "riak_core_pb.hrl"
</span><span class='line'>
</span><span class='line'>=INFO REPORT==== 11-Jul-2012::22:06:02 ===
</span><span class='line'>Writing beam file to "riak_core_pb.beam"
</span><span class='line'>Compiled src/gen_nb_server.erl
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>==> riak_pb (compile)
</span><span class='line'>Compiling src/riak.proto
</span><span class='line'>
</span><span class='line'>Compiled src/admin_gui.erl
</span><span class='line'>Compiled src/admin_cluster.erl
</span><span class='line'>==> rel (compile)
</span><span class='line'>==> riak (compile)
</span><span class='line'>Compiled src/etop_txt.erl</span></code></pre></td></tr></table></div></figure>


<p>I snipped a lot of the make output for obvious reasons. Let&#8217;s build a few development nodes of Riak and cluster them together as indicated in the <a href="https://wiki.basho.com/display/RIAK/The+Riak+Fast+Track" title="Riak Fast Track">Riak Fast Track</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/riak $ make devrel
</span><span class='line'>mkdir -p dev
</span><span class='line'>(cd rel && ../rebar generate target_dir=../dev/dev1 overlay_vars=vars/dev1_vars.config)
</span><span class='line'>==> rel (generate)
</span><span class='line'>mkdir -p dev
</span><span class='line'>(cd rel && ../rebar generate target_dir=../dev/dev2 overlay_vars=vars/dev2_vars.config)
</span><span class='line'>==> rel (generate)
</span><span class='line'>mkdir -p dev
</span><span class='line'>(cd rel && ../rebar generate target_dir=../dev/dev3 overlay_vars=vars/dev3_vars.config)
</span><span class='line'>==> rel (generate)
</span><span class='line'>mkdir -p dev
</span><span class='line'>(cd rel && ../rebar generate target_dir=../dev/dev4 overlay_vars=vars/dev4_vars.config)
</span><span class='line'>==> rel (generate)
</span><span class='line'>
</span><span class='line'>oj@air ~/blog/riak $ cd dev
</span><span class='line'>oj@air ~/blog/riak/dev $ dev1/bin/riak start
</span><span class='line'>oj@air ~/blog/riak/dev $ dev2/bin/riak start
</span><span class='line'>oj@air ~/blog/riak/dev $ dev3/bin/riak start
</span><span class='line'>oj@air ~/blog/riak/dev $ dev4/bin/riak start
</span><span class='line'>oj@air ~/blog/riak/dev $ dev2/bin/riak-admin cluster join dev1
</span><span class='line'>Success: staged join request for 'dev2@127.0.0.1' to dev1
</span><span class='line'>oj@air ~/blog/riak/dev $ dev3/bin/riak-admin cluster join dev1
</span><span class='line'>Success: staged join request for 'dev3@127.0.0.1' to dev1
</span><span class='line'>oj@air ~/blog/riak/dev $ dev4/bin/riak-admin cluster join dev1
</span><span class='line'>Success: staged join request for 'dev4@127.0.0.1' to dev1</span></code></pre></td></tr></table></div></figure>


<p>At this point our Riak cluster should be up and running. Rather than assume let&#8217;s make sure.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/riak/dev $ dev4/bin/riak-admin ringready
</span><span class='line'>TRUE All nodes agree on the ring ['dev1@127.0.0.1','dev2@127.0.0.1',
</span><span class='line'>                                  'dev3@127.0.0.1','dev4@127.0.0.1']</span></code></pre></td></tr></table></div></figure>


<p>As we can see from the output, we now have a 4-node Riak cluster up and running. Those four nodes have the following traits:</p>

<table style="border: 1px solid black; width:100%;">
  <thead>
    <tr>
      <th style="border: 1px solid black; padding: 3px;">Name</th>
      <th style="border: 1px solid black; padding: 3px;">Protobuf Port</th>
      <th style="border: 1px solid black; padding: 3px;">HTTP Port</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="border: 1px solid black; padding: 3px;">dev1@127.0.0.1</td>
      <td style="border: 1px solid black; padding: 3px;">8081</td>
      <td style="border: 1px solid black; padding: 3px;">8091</td>
    </tr>
    <tr>
      <td style="border: 1px solid black; padding: 3px;">dev2@127.0.0.1</td>
      <td style="border: 1px solid black; padding: 3px;">8082</td>
      <td style="border: 1px solid black; padding: 3px;">8092</td>
    </tr>
    <tr>
      <td style="border: 1px solid black; padding: 3px;">dev3@127.0.0.1</td>
      <td style="border: 1px solid black; padding: 3px;">8083</td>
      <td style="border: 1px solid black; padding: 3px;">8093</td>
    </tr>
    <tr>
      <td style="border: 1px solid black; padding: 3px;">dev4@127.0.0.1</td>
      <td style="border: 1px solid black; padding: 3px;">8084</td>
      <td style="border: 1px solid black; padding: 3px;">8094</td>
    </tr>
  </tbody>
</table>


<p>We can talk to any of these nodes and they will replicate their data to the other nodes. Nifty! Now that we have a Riak cluster running for development, let&#8217;s get Webmachine ready.</p>

<h3>Installing Webmachine 1.9.1</h3>

<p>Again, the process is very simple:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog $ git clone git://github.com/basho/webmachine
</span><span class='line'>Cloning into webmachine...
</span><span class='line'>remote: Counting objects: 1512, done.
</span><span class='line'>remote: Compressing objects: 100% (611/611), done.
</span><span class='line'>remote: Total 1512 (delta 957), reused 1409 (delta 869)
</span><span class='line'>Receiving objects: 100% (1512/1512), 1.32 MiB | 225 KiB/s, done.
</span><span class='line'>Resolving deltas: 100% (957/957), done.
</span><span class='line'>
</span><span class='line'>oj@air ~/blog $ cd webmachine
</span><span class='line'>oj@air ~/blog/webmachine $ make
</span><span class='line'>==> webmachine (get-deps)
</span><span class='line'>Pulling mochiweb from {git,"git://github.com/basho/mochiweb",
</span><span class='line'>                           {tag,"1.5.1-riak-1.0.x-fixes"}}
</span><span class='line'>Cloning into mochiweb...
</span><span class='line'>==> mochiweb (get-deps)
</span><span class='line'>==> mochiweb (compile)
</span><span class='line'>Compiled src/mochiweb_sup.erl
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>==> webmachine (compile)
</span><span class='line'>Compiled src/webmachine_util.erl
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>Compiled src/webmachine_request.erl</span></code></pre></td></tr></table></div></figure>


<p>As you can see, Webmachine sits on top of the <a href="http://github.com/mochi/mochiweb" title="Mochiweb">Mochiweb</a> web server.</p>

<p>To create our own application which sits on top of Webmachine, we can utilise the <code>new_webmachine.sh</code> script. So let&#8217;s do that to create our Code Smackdown (csd) site:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/webmachine $ scripts/new_webmachine.sh
</span><span class='line'>usage: new_webmachine.sh name [destdir]
</span><span class='line'>oj@air ~/blog/webmachine $ scripts/new_webmachine.sh csd ..
</span><span class='line'>==> priv (create)
</span><span class='line'>Writing /Users/oj/code/tmp/csd/README
</span><span class='line'>Writing /Users/oj/code/tmp/csd/Makefile
</span><span class='line'>Writing /Users/oj/code/tmp/csd/rebar.config
</span><span class='line'>Writing /Users/oj/code/tmp/csd/rebar
</span><span class='line'>Writing /Users/oj/code/tmp/csd/start.sh
</span><span class='line'>Writing /Users/oj/code/tmp/csd/src/csd.app.src
</span><span class='line'>Writing /Users/oj/code/tmp/csd/src/csd.erl
</span><span class='line'>Writing /Users/oj/code/tmp/csd/src/csd_app.erl
</span><span class='line'>Writing /Users/oj/code/tmp/csd/src/csd_sup.erl
</span><span class='line'>Writing /Users/oj/code/tmp/csd/src/csd_resource.erl
</span><span class='line'>Writing /Users/oj/code/tmp/csd/priv/dispatch.conf</span></code></pre></td></tr></table></div></figure>


<p>Webmachine generates a fully functional website out of the box. So we should be able to build it, fire it up and see it in action:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/webmachine $ cd ../csd
</span><span class='line'>oj@air ~/blog/csd $ make
</span><span class='line'>==> csd (get-deps)
</span><span class='line'>Pulling webmachine from {git,"git://github.com/basho/webmachine","HEAD"}
</span><span class='line'>Cloning into webmachine...
</span><span class='line'>==> webmachine (get-deps)
</span><span class='line'>Pulling mochiweb from {git,"git://github.com/basho/mochiweb",
</span><span class='line'>                           {tag,"1.5.1-riak-1.0.x-fixes"}}
</span><span class='line'>Cloning into mochiweb...
</span><span class='line'>==> mochiweb (get-deps)
</span><span class='line'>==> mochiweb (compile)
</span><span class='line'>Compiled src/mochiweb_sup.erl
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>Compiled src/csd_sup.erl
</span><span class='line'>
</span><span class='line'>oj@air ~/blog/csd $ ./start.sh
</span><span class='line'>Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:4:4] [async-threads:0] [hipe] [kernel-poll:false]
</span><span class='line'>
</span><span class='line'>   ... snip ...
</span><span class='line'>
</span><span class='line'>=PROGRESS REPORT==== 11-Jul-2012::22:31:27 ===
</span><span class='line'>          supervisor: {local,csd_sup}
</span><span class='line'>             started: [{pid,&lt;0.75.0>},
</span><span class='line'>                       {name,webmachine_mochiweb},
</span><span class='line'>                       {mfargs,
</span><span class='line'>                           {webmachine_mochiweb,start,
</span><span class='line'>                               [[{ip,"0.0.0.0"},
</span><span class='line'>                                 {port,8000},
</span><span class='line'>                                 {log_dir,"priv/log"},
</span><span class='line'>                                 {dispatch,[{[],csd_resource,[]}]}]]}},
</span><span class='line'>                       {restart_type,permanent},
</span><span class='line'>                       {shutdown,5000},
</span><span class='line'>                       {child_type,worker}]
</span><span class='line'>
</span><span class='line'>=PROGRESS REPORT==== 11-Jul-2012::22:31:27 ===
</span><span class='line'>         application: csd
</span><span class='line'>          started_at: nonode@nohost</span></code></pre></td></tr></table></div></figure>


<p>The application is now up and running. As you can see from the output, our csd application has been fired up and is listening on port 8000. Let&#8217;s fire it up in a web browser to see if it works.</p>

<p><img src="/uploads/2010/09/wm_default.png"/></p>

<p>It&#8217;s alive! We&#8217;re almost done. Before we finish up, let&#8217;s get set up our build to include some dependencies.</p>

<h3>Adding ErlyDTL and Riak Client Dependencies</h3>

<p>Rebar makes this bit a walk in the park (thanks <a href="http://dizzyd.com/" title="Gradual Epiphany">Dave</a>, you rock!). Just make sure you stop your Webmachine node before continuing by typing <code>q().</code> into your Erlang console.</p>

<p>The <code>rebar.config</code> file is what drives rebar&#8217;s dependency mechanism. We need to open this file and add the entries we need to include in our application. Webmachine&#8217;s <code>start.sh</code> script by default includes all of the dependencies on start up, so after modifying the configuration, we don&#8217;t have to do anything else (other than use the library of course).</p>

<p>Open up <code>rebar.config</code> in your <a href="http://www.vim.org/" title="VIM">favourite editor</a>, it should look something like this:</p>

<figure class='code'><figcaption><span>rebar.config  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%%-*- mode: erlang -*-</span>
</span><span class='line'>
</span><span class='line'><span class="p">{</span><span class="n">deps</span><span class="p">,</span> <span class="p">[{</span><span class="n">webmachine</span><span class="p">,</span> <span class="s">&quot;1.9.*&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/basho/webmachine&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">}}]}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Edit the file so that it includes both ErlyDTL and the Riak Client:</p>

<figure class='code'><figcaption><span>rebar.config  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="c">%%-*- mode: erlang -*-</span>
</span><span class='line'><span class="p">{</span><span class="n">deps</span><span class="p">,</span>
</span><span class='line'>  <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span><span class="n">webmachine</span><span class="p">,</span> <span class="s">&quot;.*&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/basho/webmachine&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">riakc</span><span class="p">,</span> <span class="s">&quot;.*&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/basho/riak-erlang-client&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">}},</span>
</span><span class='line'>    <span class="p">{</span><span class="n">erlydtl</span><span class="p">,</span> <span class="s">&quot;.*&quot;</span><span class="p">,</span> <span class="p">{</span><span class="n">git</span><span class="p">,</span> <span class="s">&quot;git://github.com/OJ/erlydtl.git&quot;</span><span class="p">,</span> <span class="s">&quot;HEAD&quot;</span><span class="p">}}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>You&#8217;ll notice that the <code>erlydtl</code> reference points at my own fork of the ErlyDTL project. This is because I have made it compile cleanly with rebar so that any dependent projects are also able to be build with rebar. Feel free to use your own fork if you like, but mine is there if you can&#8217;t be bothered :)</p>

<p>Save the file and build!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/csd $ make
</span><span class='line'>==> mochiweb (get-deps)
</span><span class='line'>==> webmachine (get-deps)
</span><span class='line'>==> csd (get-deps)
</span><span class='line'>Pulling riakc from {git,"git://github.com/basho/riak-erlang-client","HEAD"}
</span><span class='line'>Cloning into riakc...
</span><span class='line'>
</span><span class='line'>  ... snip ...</span></code></pre></td></tr></table></div></figure>


<p>Dependencies sorted. For the final part of this blog post, we&#8217;ll include a basic ErlyDTL template and use it to render the page so we can see how it works.</p>

<h3>Rendering an ErlyDTL Template</h3>

<p>Rebar has built-in support for the compilation of ErlyDTL templates. It can be configured to behave how you want it to, but out of the box it&#8230;</p>

<ul>
<li>&#8230; looks for <code>*.dtl</code> files in the <code>./templates</code> folder</li>
<li>&#8230; compiles each of the found templates into a module called <code>filename_dtl</code> (eg. <code>base.dtl</code> becomes the module base_dtl)</li>
<li>&#8230; puts the module beam files into the <code>ebin</code> directory</li>
</ul>


<p>Very handy. Let&#8217;s create a very simple template by creating a <code>templates</code> folder, and editing a new file in that folder called <code>sample.dtl</code></p>

<figure class='code'><figcaption><span>templates/sample.dtl  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;&lt;body&gt;</span>Hello from inside ErlyDTL. You passed in {{ param }}.<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then open up <code>src/csd_resource.erl</code> and search for the <code>to_html()</code> function. It should look like this:</p>

<figure class='code'><figcaption><span>src/csd_resource.erl  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">to_html</span><span class="p">(</span><span class="nv">ReqData</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="s">&quot;&lt;html&gt;&lt;body&gt;Hello, new world&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">,</span> <span class="nv">ReqData</span><span class="p">,</span> <span class="nv">State</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>Modify it to look like this:</p>

<figure class='code'><figcaption><span>src/csd_resource.erl  </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='erlang'><span class='line'><span class="nf">to_html</span><span class="p">(</span><span class="nv">ReqData</span><span class="p">,</span> <span class="nv">State</span><span class="p">)</span> <span class="o">-&gt;</span>
</span><span class='line'>    <span class="p">{</span><span class="n">ok</span><span class="p">,</span> <span class="nv">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nn">sample_dtl</span><span class="p">:</span><span class="n">render</span><span class="p">([{</span><span class="n">param</span><span class="p">,</span> <span class="s">&quot;Slartibartfast&quot;</span><span class="p">}]),</span>
</span><span class='line'>    <span class="p">{</span><span class="nv">Content</span><span class="p">,</span> <span class="nv">ReqData</span><span class="p">,</span> <span class="nv">State</span><span class="p">}.</span>
</span></code></pre></td></tr></table></div></figure>


<p>For now, don&#8217;t worry about the content of this file. I will cover this off in a future post.</p>

<p>In the past, we had to manually modify <code>ebin/csd.app</code> to include the template that we&#8217;ve just created. Thankfully, <code>rebar</code> has been updated so that it generates the <code>ebin/csd.app</code> file from the <code>src/csd.app.src</code> file automatically when the application is built. <code>rebar</code> adds the required modules from the <code>src</code> folder <em>and</em> includes the templates from the <code>templates</code> folder. Therefore, with our template and module ready to go, all we need to do is build and run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>oj@air ~/blog/csd $ make
</span><span class='line'>==> mochiweb (get-deps)
</span><span class='line'>==> webmachine (get-deps)
</span><span class='line'>==> protobuffs (get-deps)
</span><span class='line'>==> riakc (get-deps)
</span><span class='line'>==> erlydtl (get-deps)
</span><span class='line'>==> csd (get-deps)
</span><span class='line'>==> mochiweb (compile)
</span><span class='line'>==> webmachine (compile)
</span><span class='line'>==> protobuffs (compile)
</span><span class='line'>==> riakc (compile)
</span><span class='line'>==> erlydtl (compile)
</span><span class='line'>==> csd (compile)
</span><span class='line'>Compiled src/csd_resource.erl
</span><span class='line'>Compiled templates/sample.dtl
</span><span class='line'>
</span><span class='line'>oj@air ~/blog/csd $ ./start.sh 
</span><span class='line'>Erlang R15B01 (erts-5.9.1) [source] [64-bit] [smp:2:2] [rq:2] [async-threads:0] [hipe] [kernel-poll:false]
</span><span class='line'>
</span><span class='line'>  ... snip ...
</span><span class='line'>
</span><span class='line'>** Found 0 name clashes in code paths 
</span><span class='line'>
</span><span class='line'>  ... snip ...
</span><span class='line'>
</span><span class='line'>=PROGRESS REPORT==== 11-Jul-2012::22:31:27 ===
</span><span class='line'>         application: csd
</span><span class='line'>          started_at: nonode@nohost</span></code></pre></td></tr></table></div></figure>


<p>Notice how ErlyDTL outputs some information to indicate that no template names have clashed with any other modules.</p>

<p>The application is now running, let&#8217;s see what it looks like:</p>

<p><img src="/uploads/2010/09/wm_erlydtl.png"/></p>

<h3>The End</h3>

<p>We now have a working environment in which to do our development. In the next post, I&#8217;ll cover some of the basics required to get Webmachine talking to Riak via <a href="http://en.wikipedia.org/wiki/Protocol_Buffers" title="Protocol Buffers">Protocol Buffers</a>.</p>

<p>Feedback and criticism welcome!</p>

<p><strong>Note:</strong> The code for Part 1 (this post) can be found on <a href="https://github.com/OJ/csd/tree/Part1-20110403" title="Source Code for Part 1">Github</a>.</p>

<p>Other parts in this series: <a href="/posts/webmachine-erlydtl-and-riak-part-2/" title="Webmachine, ErlyDTL and Riak - Part 2">Part 2</a>, <a href="/posts/webmachine-erlydtl-and-riak-part-3/" title="Webmachine, ErlyDTL and Riak - Part 3">Part 3</a>, <a href="/posts/webmachine-erlydtl-and-riak-part-4/" title="Webmachine, ErlyDTL and Riak - Part 4">Part 4</a>, <a href="/posts/webmachine-erlydtl-and-riak-part-5/" title="Webmachine, ErlyDTL and Riak - Part 5">Part 5</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">OJ Reeves</span></span>

      








  



  

<time datetime="2012-07-11T21:50:00+10:00" class="updated">Updated 11 Jul 2012</time>
      

<span class="categories">
  
    <a class='category' href='/categories/databases/'>Databases</a>, <a class='category' href='/categories/erlang/'>Erlang</a>, <a class='category' href='/categories/functional-programming/'>Functional Programming</a>, <a class='category' href='/categories/howto/'>HOWTO</a>, <a class='category' href='/categories/riak/'>Riak</a>, <a class='category' href='/categories/webmachine/'>Webmachine</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://buffered.io/posts/webmachine-erlydtl-and-riak-part-1/" data-via="TheColonial" data-counturl="http://buffered.io/posts/webmachine-erlydtl-and-riak-part-1/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/posts/bfpg-june-meetup/" title="Previous Post: BFPG June Meetup">&laquo; BFPG June Meetup</a>
      
      
        <a class="basic-alignment right" href="/posts/webmachine-erlydtl-and-riak-part-2/" title="next Post: Webmachine, ErlyDTL and Riak - Part 2">Webmachine, ErlyDTL and Riak - Part 2 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>OJ on the Web</h1>
  <ul id="about_me">
    <li class="post">
      <a href="http://buffered.io/+" title="About OJ">About me</a>
    </li>
    <li class="post">
      <a href="http://functional.io/" title="Functional IO">Functional IO</a>
    </li>
    <li class="post">
      <a href="http://twitter.com/TheColonial" title="OJ @ Twitter">Twitter</a>
    </li>
    <li class="post">
      <a href="http://github.com/OJ/" title="OJ @ Github">Github</a>
    </li>
    <li class="post">
      <a href="http://bitbucket.org/OJ/" title="OJ @ Bitbucket">Bitbucket</a>
    </li>
    <li class="post">
      <a href="http://stackoverflow.com/users/611/oj" title="OJ @ SO">StackOverflow</a>
    </li>
  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/posts/webmachine-erlydtl-and-riak-part-5/">Webmachine, ErlyDTL and Riak - Part 5</a>
      </li>
    
      <li class="post">
        <a href="/posts/webmachine-erlydtl-and-riak-part-4/">Webmachine, ErlyDTL and Riak - Part 4</a>
      </li>
    
      <li class="post">
        <a href="/posts/redirects-with-webmachine/">Redirects with Webmachine</a>
      </li>
    
      <li class="post">
        <a href="/posts/my-tools-list-2012/">My Tools List - 2012</a>
      </li>
    
      <li class="post">
        <a href="/posts/an-expert-at-23/">An Expert at 23</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("TheColonial", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/TheColonial" class="twitter-follow-button" data-show-count="false">Follow @TheColonial</a>
  
</section>

<section>
  <h1>Series</h1>
  <ul id="series">
    <li class='series'><a href='/series/project-euler/'>Project Euler (11)</a></li>
<li class='series'><a href='/series/web-development-with-erlang/'>Web Development with Erlang (5)</a></li>

  </ul>
</section>
<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/categories/asm/'>ASM (3)</a></li>
<li class='category'><a href='/categories/asp-net/'>ASP.NET (3)</a></li>
<li class='category'><a href='/categories/agile/'>Agile (1)</a></li>
<li class='category'><a href='/categories/algorithms/'>Algorithms (6)</a></li>
<li class='category'><a href='/categories/apple/'>Apple (3)</a></li>
<li class='category'><a href='/categories/backbonejs/'>BackboneJS (1)</a></li>
<li class='category'><a href='/categories/being-in-the-industry/'>Being in the Industry (28)</a></li>
<li class='category'><a href='/categories/blogging/'>Blogging (15)</a></li>
<li class='category'><a href='/categories/bootstrap/'>Bootstrap (1)</a></li>
<li class='category'><a href='/categories/c-/'>C# (15)</a></li>
<li class='category'><a href='/categories/clr/'>CLR (3)</a></li>
<li class='category'><a href='/categories/challenges/'>Challenges (7)</a></li>
<li class='category'><a href='/categories/databases/'>Databases (6)</a></li>
<li class='category'><a href='/categories/digital-rights/'>Digital Rights (7)</a></li>
<li class='category'><a href='/categories/erlang/'>Erlang (8)</a></li>
<li class='category'><a href='/categories/erlydtl/'>ErlyDTL (2)</a></li>
<li class='category'><a href='/categories/f-/'>F# (4)</a></li>
<li class='category'><a href='/categories/fail/'>Fail (2)</a></li>
<li class='category'><a href='/categories/food/'>Food (1)</a></li>
<li class='category'><a href='/categories/freeware/'>Freeware (9)</a></li>
<li class='category'><a href='/categories/functional-programming/'>Functional Programming (28)</a></li>
<li class='category'><a href='/categories/funny/'>Funny (9)</a></li>
<li class='category'><a href='/categories/games/'>Games (5)</a></li>
<li class='category'><a href='/categories/google/'>Google (10)</a></li>
<li class='category'><a href='/categories/guest-posts/'>Guest posts (1)</a></li>
<li class='category'><a href='/categories/howto/'>HOWTO (18)</a></li>
<li class='category'><a href='/categories/hardware/'>Hardware (9)</a></li>
<li class='category'><a href='/categories/haskell/'>Haskell (20)</a></li>
<li class='category'><a href='/categories/linux/'>Linux (10)</a></li>
<li class='category'><a href='/categories/mac-os/'>Mac OS (2)</a></li>
<li class='category'><a href='/categories/merb/'>Merb (1)</a></li>
<li class='category'><a href='/categories/mercurial/'>Mercurial (3)</a></li>
<li class='category'><a href='/categories/microsoft/'>Microsoft (18)</a></li>
<li class='category'><a href='/categories/miscellaneous/'>Miscellaneous (56)</a></li>
<li class='category'><a href='/categories/mono/'>Mono (2)</a></li>
<li class='category'><a href='/categories/networks/'>Networks (2)</a></li>
<li class='category'><a href='/categories/nosql/'>NoSQL (3)</a></li>
<li class='category'><a href='/categories/oauth/'>OAuth (1)</a></li>
<li class='category'><a href='/categories/open-source/'>Open Source (2)</a></li>
<li class='category'><a href='/categories/privacy/'>Privacy (3)</a></li>
<li class='category'><a href='/categories/productivity/'>Productivity (1)</a></li>
<li class='category'><a href='/categories/project-euler/'>Project Euler (11)</a></li>
<li class='category'><a href='/categories/rce/'>RCE (4)</a></li>
<li class='category'><a href='/categories/riak/'>Riak (7)</a></li>
<li class='category'><a href='/categories/ruby-on-rails/'>Ruby on Rails (1)</a></li>
<li class='category'><a href='/categories/screencasts/'>Screencasts (1)</a></li>
<li class='category'><a href='/categories/security/'>Security (10)</a></li>
<li class='category'><a href='/categories/series/'>Series (1)</a></li>
<li class='category'><a href='/categories/shortcuts/'>Shortcuts (4)</a></li>
<li class='category'><a href='/categories/software/'>Software (31)</a></li>
<li class='category'><a href='/categories/software-development/'>Software Development (66)</a></li>
<li class='category'><a href='/categories/sorting/'>Sorting (5)</a></li>
<li class='category'><a href='/categories/technology/'>Technology (40)</a></li>
<li class='category'><a href='/categories/testing/'>Testing (1)</a></li>
<li class='category'><a href='/categories/tips-tricks/'>Tips/Tricks (11)</a></li>
<li class='category'><a href='/categories/twitter/'>Twitter (2)</a></li>
<li class='category'><a href='/categories/wpf/'>WPF (1)</a></li>
<li class='category'><a href='/categories/wtf/'>WTF (20)</a></li>
<li class='category'><a href='/categories/webmachine/'>Webmachine (7)</a></li>
<li class='category'><a href='/categories/windows/'>Windows (12)</a></li>

  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
Copyright &copy; 2012 -
<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Blog content for OJ's rants</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://buffered.io/+" property="cc:attributionName" rel="cc:attributionURL">OJ Reeves</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a> -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ojsrants';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://buffered.io/posts/webmachine-erlydtl-and-riak-part-1/';
        var disqus_url = 'http://buffered.io/posts/webmachine-erlydtl-and-riak-part-1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
